<!DOCTYPE html>
<html lang=\"en\">
  <head>
    <meta charset=\"utf-8\" />
    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\" />
    <title>Hyperlocal Climate Companion</title>
    <link rel=\"manifest\" href=\"/static/manifest.json\" />
    <link rel=\"stylesheet\" href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css\" />
  </head>
  <body class=\"bg-light\">
    <main class=\"container py-4\">
      <h1 class=\"mb-3\">Hyperlocal Alerts</h1>
      <p class=\"text-muted\">Lightweight offline-capable view of forecasts and recommendations.</p>
      <form id=\"forecast-form\" class=\"row g-2\">
        <div class=\"col\">
          <label class=\"form-label\" for=\"lat\">Latitude</label>
          <input class=\"form-control\" id=\"lat\" name=\"lat\" value=\"0\" />
        </div>
        <div class=\"col\">
          <label class=\"form-label\" for=\"lon\">Longitude</label>
          <input class=\"form-control\" id=\"lon\" name=\"lon\" value=\"0\" />
        </div>
        <div class=\"col-12\">
          <button class=\"btn btn-primary\" type=\"submit\">Fetch forecast</button>
        </div>
      </form>
      <section class=\"mt-4\">
        <h2>Forecast</h2>
        <pre id=\"forecast\" class=\"bg-white p-3 border rounded\"></pre>
      </section>
    </main>
    <script>
      async function fetchForecast(lat, lon) {
        const response = await fetch(/forecast?lat=&lon=);
        if (!response.ok) {
          throw new Error('Failed to fetch forecast');
        }
        return await response.json();
      }

      document.getElementById('forecast-form').addEventListener('submit', async (event) => {
        event.preventDefault();
        const lat = document.getElementById('lat').value;
        const lon = document.getElementById('lon').value;
        const el = document.getElementById('forecast');
        el.textContent = 'Loading...';
        try {
          const data = await fetchForecast(lat, lon);
          el.textContent = JSON.stringify(data, null, 2);
        } catch (error) {
          el.textContent = error.message;
        }
      });

      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/static/sw.js').catch((err) => console.error('Service worker failed', err));
        });
      }
    </script>
  </body>
</html>
